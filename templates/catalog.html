{% extends "base.html" %}
{% block title %}Каталог — Шиповник{% endblock %}

{% block content %}

<!-- ====================== HERO КАТАЛОГА ====================== -->
<section class="catalog-hero">
    <div class="container">
        <h1 class="catalog-hero__title">
            {% if current_category %}
                {{ current_category.name }}
            {% elif novelties %}
                Новинки
            {% else %}
                Каталог
            {% endif %}
        </h1>

        <p class="catalog-hero__subtitle">
            {% if current_category %}
                Товары из категории «{{ current_category.name }}» с любовью для тебя ♡
            {% elif novelties %}
                Последние добавленные товары
            {% else %}
                Более 500 моделей с любовью для тебя ♡
            {% endif %}
        </p>
    </div>
</section>

<!-- ====================== ФИЛЬТРЫ И СЕТКА ====================== -->
<section class="catalog">
    <div class="container">
        <div class="catalog__inner">

            <!-- Боковая панель с категориями (на мобильных — сверху) -->
            <aside class="sidebar">
                <h3 class="sidebar__title">Категории</h3>
                <ul class="category-list">
                    <!-- Все категории из базы -->
                    {% for cat in categories %}
                    <li class="category-item">
                                {# Ссылка на категорию: сохраняем текущие быстрые фильтры (new, sale) #}
                                <a href="{{ url_for('catalog') }}?category={{ cat.slug }}{% if request.args.get('new') %}&amp;new={{ request.args.get('new') }}{% endif %}{% if request.args.get('sale') %}&amp;sale={{ request.args.get('sale') }}{% endif %}"
                                    class="category-link {% if request.args.get('category') == cat.slug %}active{% endif %}">
                            <span class="category-icon">{{ cat.icon }}</span>
                            {{ cat.name }}
                            <span class="category-count">({{ cat.products|length }})</span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>

                <!-- Быстрые фильтры -->
                <div class="quick-filters">
                    {# Ссылка фильтра 'new' сохраняет выбранную категорию, если есть #}
                    <a href="{{ url_for('catalog') }}{% if request.args.get('category') %}?category={{ request.args.get('category') }}&amp;new=true{% else %}?new=true{% endif %}"
                       class="quick-filter {% if request.args.get('new') %}active{% endif %}">
                        Новинки
                    </a>
                    {# Ссылка фильтра 'sale' сохраняет выбранную категорию, если есть #}
                    <a href="{{ url_for('catalog') }}{% if request.args.get('category') %}?category={{ request.args.get('category') }}&amp;sale=true{% else %}?sale=true{% endif %}"
                       class="quick-filter {% if request.args.get('sale') %}active{% endif %}">
                        Распродажа
                    </a>
                </div>
            </aside>

            <!-- Сетка товаров -->
            <div class="products-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 30px; margin-top: 20px;">
                {% if products|length == 0 %}
                    <p class="no-products">Товаров пока нет. Но скоро будут! ♡</p>
                {% else %}
                    {% for product in products %}
                        {% include 'product_card.html' %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
</section>

{% endblock %}